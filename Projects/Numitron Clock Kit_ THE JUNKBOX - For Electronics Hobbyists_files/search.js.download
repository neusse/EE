
(function($){$.fn.predictiveSearch=function(options){var settings=$.extend({hasKeyboardNavigation:true,timeOut:500},options);$(this).attr('autocomplete','off');return this.each(function(index,el){var predictiveSearchTimer=null;var searchInput=this;var searchResultContainer=$('.predictive-search-results');if($(searchResultContainer).length==0){searchResultContainer=$('<div>',{class:'predictive-search-results',style:'display:none'});$(searchResultContainer).appendTo('header form');}
$(searchInput).keyup(function(e){let headerSearch=1;if($(this).closest('#main').length>0){$('#input-search-str').after(searchResultContainer);headerSearch=0;}else{$(searchResultContainer).appendTo('header form');}
var code=e.keyCode||e.which;switch(code){case 13:{var href=searchResultContainer.find('li.selected a').attr('href');if(href!=null)document.location=href;break;}
case 38:{if(!settings.hasKeyboardNavigation)return;var selected=searchResultContainer.find('.selected');if(selected.length==0)
searchResultContainer.find('ul li:not(.disabled):last').addClass('selected');var prev=selected.prevAll('.list-group-item:not(.disabled):first');if(prev.length>0&&!prev.hasClass('disabled')){searchResultContainer.find('.selected').removeClass('selected');$(prev).addClass('selected');}
break;}
case 40:{if(!settings.hasKeyboardNavigation)return;var selected=searchResultContainer.find('.selected');if(selected.length==0)
searchResultContainer.find('ul li:not(.disabled):first').addClass('selected');var next=selected.nextAll('.list-group-item:not(.disabled):first');if(next.length>0&&!next.hasClass('disabled')){searchResultContainer.find('.selected').removeClass('selected');$(next).addClass('selected');}
break;}
case 27:{$(searchResultContainer).hide();break;}
case 37:case 39:{break;}
default:{var str=$(this).val().trim();if(str.length>0){var html='';if(predictiveSearchTimer)clearTimeout(predictiveSearchTimer);predictiveSearchTimer=setTimeout(function(){$.ajax({url:'index.php?p=catalog&ua=user_predictive_search&mode=search',method:'POST',dataType:'json',data:{search_str:str},success:function(response,status){if(response&&response.status&&response.results&&response.count>0&&$(searchInput).is(':focus')){$.each(response.results,function(index,item){if(item.type='group'){if(item.url===undefined){html+='<li class="list-group-item disabled">'+(item.title)+' ('+item.count+')</li>';}else{html+='<li class="list-group-item"><a href="'+item.url+'">'+(item.title)+' ('+item.count+')</a></li>';}
$.each(item.items,function(subIndex,subItem){html+='<li class="list-group-item"><a href="'+subItem.url+'">'+(subItem.title)+'</a></li>';});}else{html+='<li class="list-group-item"><a href="'+item.url+'">'+(item.title)+'</a></li>';}});searchResultContainer.html('<div class="inner-div"><ul class="list-group">'+html+'</ul></div>');var searchInputOffset=$(searchInput).offset();searchResultContainer.css({position:'absolute',left:'0',width:'100%',padding:headerSearch?'0 1rem':'0'}).show();}else{$(searchResultContainer).hide();}}});},500);}else{$(searchResultContainer).hide();}}}});searchResultContainer.on('mouseover','ul li.list-group-item',function(){if(!$(this).hasClass('disabled')){$(this).focus();$(searchResultContainer).find('.selected').removeClass('selected');$(this).addClass('selected');}});$(document).on('mouseup',function(e){if(!searchResultContainer.is(e.target)&&searchResultContainer.has(e.target).length===0){$(searchResultContainer).hide();}});});}}(jQuery));$(document).ready(function(){$('input[name="search_str"]').each(function(){$(this).predictiveSearch({});});});
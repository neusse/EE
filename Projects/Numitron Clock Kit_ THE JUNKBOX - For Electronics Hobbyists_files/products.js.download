
var shoppingCartProducts=(function(){var init,calcAttrPrice,setHTMLPrice,addToWishList,addToCart,showProductReviews,submitProductReview,inventoryHashFound=false;init=function(){$(document).ready(function(){if(window.document.documentMode){$('.product-twitter-button').addClass('d-none');}else{$('.product-twitter-button').removeClass('d-none');}
$('.form-add-to-cart').on('submit',addToCart);if($('.page-product').length>0){$('.product-attribute-radio').on('click',calcAttrPrice);$('.product-attribute-select').on('change',calcAttrPrice);preSelectFirstAvailableVariant(productData);if(parseInt(productData.stock)<1&&productData.allowOutOfInventoryOrder=='Yes'){$('#product_stock').parent().hide();}
calcAttrPrice();$('#form-wishlist').on('submit',addToWishList);var url=document.location.toString();if(url.match('#product-reviews'))showProductReviews();$('.product-reviews-link').on('click',function(e){e.preventDefault();showProductReviews();return false;});$('#new-product-review-submit').on('click',function(){submitProductReview();return false;});}});};showProductReviews=function(){$([document.documentElement,document.body]).animate({scrollTop:$('#product-tabs').offset().top},1000);$('.nav-tabs a[href="#nav-product-reviews"]').tab('show');};submitProductReview=function(){let errorMessage='',focusElement=null,newProductReviewTitle=$('#new-product-review-title').val().trim(),newProductReviewText=$('#new-product-review-text').val().trim(),newProductReviewRating=$('#new-product-rating').val().trim();if(newProductReviewTitle==''){errorMessage+='- '+msg.reviews_alert_title_empty+'\n';focusElement=$('#new-product-review-title');}else if(newProductReviewTitle.length<3){errorMessage+='- '+msg.reviews_alert_title_minimum_input+'\n';focusElement=$('#new-product-review-title');}
if(newProductReviewText==''){errorMessage+='- '+msg.reviews_alert_text_empty+'\n';if(focusElement==null)focusElement=$('#new-product-review-text');}else if(newProductReviewText.length<10){errorMessage+='- '+msg.reviews_alert_text_minimum_input+'\n';if(focusElement==null)focusElement=$('#new-product-review-text');}
if(newProductReviewRating==''){errorMessage+='- '+msg.reviews_alert_rating+'\n';if(focusElement==null)focusElement=$('#new-product-rating');}
if(errorMessage!=''){alert(errorMessage.trim());if(focusElement!=null){$(focusElement).focus();}
return false;}
$.ajax({type:'POST',url:site_https_url+'ua=AddReview',data:{pid:$('#pid').val(),rating:newProductReviewRating,review_title:newProductReviewTitle,review_text:newProductReviewText},dataType:'json',success:function(){$('#new-product-review-title').val('');$('#new-product-review-text').val('');$('#new-product-rating').val('5');$('#new-product-review-modal').modal('hide');$.notify({message:msg.reviews_thank_you},{type:'success',delay:2500,mouse_over:'pause',placement:{from:"top",align:"center"},newest_on_top:true,animate:{enter:'animated fadeInDown',exit:'animated fadeOutUp'}});}});};calcAttrPrice=function(){var priceDiff=0,billingAmountDiff=0,trialAmountDiff=0,weightDiff=0,attributesList="",attributesHash="",hasMissingAttribute=false,useWholesalePrice=productData.userLevel>0&&productData.wholesaleDiscountType=='PRODUCT',val;$.each(productData.productAttributes,function(i,attribute){let attributeInputType=$('input[name="oa_attributes['+attribute.paid+']"],select[name="oa_attributes['+attribute.paid+']"]').prop('type');if(attributeInputType=='select-one'||attributeInputType=='radio'){let ctrl=(attributeInputType=='select-one')?$('#attribute_input_'+attribute.paid):$('input[name="oa_attributes['+attribute.paid+']"]:checked');val=urldecode(ctrl.val());if(typeof(attribute.options[val])!='undefined'){priceDiff+=useWholesalePrice?attribute.options[val].price_wholesale_difference:attribute.options[val].price_difference;trialAmountDiff+=attribute.options[val].trial_amount_difference;billingAmountDiff+=attribute.options[val].billing_amount_difference;weightDiff=weightDiff+attribute.options[val].weight_difference;if(attribute.track_inventory==1){if(attributesHash!='')attributesHash=attributesHash+'\n';attributesHash+=attribute.paid+': '+val;if(attributesList!='')attributesList=attributesList+'\n';attributesList+=attribute.name+': '+val;}}}});if(productData.displayPricesWithTax&&productData.taxRate>0)
{priceDiff+=(priceDiff*productData.taxRate/100);billingAmountDiff+=(billingAmountDiff*productData.taxRate/100);trialAmountDiff+=(trialAmountDiff*productData.taxRate/100);}
if(parseInt($('input[name="oa_recurring"]').val())){if(useWholesalePrice){productData.initialPrice=+productData.productPriceWholesale;}
if(productData.allowPriceModificationAffectRecurringPrice){setHTMLPrice('#product_initial_fee',(productData.initialPrice+priceDiff)<0?0:productData.initialPrice+priceDiff);setHTMLPrice('.product-price-amount-recurring #product_price',(productData.billingAmount+billingAmountDiff)<0?0:productData.billingAmount+billingAmountDiff);setHTMLPrice('#product_recurring_billing .bill-amount',(productData.billingAmount+billingAmountDiff)<0?0:productData.billingAmount+billingAmountDiff);setHTMLPrice('#product_trial_billing .bill-amount',(productData.trialAmount+trialAmountDiff)<0?0:productData.trialAmount+trialAmountDiff);}else{setHTMLPrice('#product_initial_fee',(productData.initialPrice+priceDiff)<0?0:productData.initialPrice+priceDiff);}}else{setHTMLPrice('#product_price',(productData.price+priceDiff)<0?0:productData.price+priceDiff);}
if(productData.price2!=null)setHTMLPrice('#product_price2',(productData.price2+priceDiff)<0?0:productData.price2+priceDiff);if(useWholesalePrice){let wholesalePrice=productData.wholesaleDiscountType=="PRODUCT"?(+productData.productPriceWholesale+priceDiff):((+productData.productPriceWholesale+priceDiff)/100*(100-productData.productPriceWholesaleDiscount));setHTMLPrice("#product_price_wholesale",wholesalePrice<0?0:wholesalePrice);}
$('product_weight').html(number_format(productData.weight+weightDiff,2,".",",")+' '+productData.localizationWeightUnits);if(typeof(productData.inventoryHashes)=='undefined')productData.inventoryHashes=false;if((productData.inventoryHashes&&productData.inventoryHashes.length>0)||productData.inventoryControl=='AttrRuleExc'||productData.inventoryControl=='AttrRuleInc'){let variantStock=productData.inventoryControl=='AttrRuleExc'||productData.inventoryControl=='AttrRuleInc',current_hash=hex_md5(unescape(encodeURIComponent(attributesHash)));productMayBeAdded=false;inventoryHashFound=false;$.each(productData.inventoryHashes,function(i,inventory_hash){if(inventory_hash.attributes_hash==current_hash){inventoryHashFound=true;if(productData.inventoryControl=='No'){productMayBeAdded=productCanBeAddedToCart(false);}else{if(productData.allowOutOfInventoryOrder=='No'){productData.stock=variantStock?inventory_hash.stock:productData.stock;if(parseInt(productData.stock)<parseInt(productData.displayStockOnProductPageThreshold)){showProductStock(productData.stock);}else{hideProductStock(0);}
if(parseInt(productData.stock)>0){if(productData.inventoryControl=='AttrRuleExc'){if(parseInt(productData.stock)<productData.minOrder){productMayBeAdded=productCannotBeAddedToCart();}else{productMayBeAdded=productCanBeAddedToCart(productData.stock);}}else{productMayBeAdded=productCanBeAddedToCart(productData.stock);}}else{productMayBeAdded=productCannotBeAddedToCart();}}else{if(parseInt(productData.stock)<1){hideProductStock(0);}
productMayBeAdded=productCanBeAddedToCart(productData.stock);}}}});if(!inventoryHashFound){if(productData.allowOutOfInventoryOrder!='Yes'){if(variantStock)productData.stock=0;if(productData.inventoryControl=='AttrRuleInc'&&!hasMissingAttribute){showProductStock(productData.stock);productMayBeAdded=productCanBeAddedToCart(productData.stock);}else{if(parseInt(productData.stock)<parseInt(productData.displayStockOnProductPageThreshold)){showProductStock(productData.stock);}else{hideProductStock(0);}
hideProductStock(0);productMayBeAdded=productCannotBeAddedToCart();}}else{hideProductStock(0);productMayBeAdded=productCannotBeAddedToCart();}}}};setHTMLPrice=function(elId,amount){let divider=Math.pow(10,currentCurrency.decimalPlaces),r=Math.round(amount*currentCurrency.exchangeRate*divider)/divider,amountStr=currentCurrency.symbolLeft+
number_format(r,currentCurrency.decimalPlaces,currentCurrency.localizationDecimalSymbol,currentCurrency.localizationSeparatingSymbol)+
currentCurrency.symbolRight;amountStr=(currentCurrency.localizationSeparatingSymbol!=' ')?amountStr.replace(' ',''):amountStr;$(elId).html(amountStr);};addToCart=function(){let frm=this,minOrder=$(this).attr('data-min-order'),maxOrder=$(this).attr('data-max-order'),maxAllowed=$(this).attr('data-max-allowed'),requiredAttributeError='';if($('.page-product .product-attribute').length>0){$('.product-attribute').each(function(){let attributeRequired=$(this).attr('data-attribute-required');if(attributeRequired=='Yes'&&requiredAttributeError==''){let attributeType=$(this).attr('data-attribute-type'),attributeCaption=$(this).find('.product-attribute-caption').text();switch(attributeType){case'select':{if(($(this).find('select').val()=='')){requiredAttributeError=msg.to_continue_please_check+' '+attributeCaption;$(this).find('select')[0].focus();}
break;}
case'radio':{if(($(this).find('input[type=radio]:checked').val()=='')){requiredAttributeError=msg.to_continue_please_check+' '+attributeCaption;$(this).find('input[type=radio]:checked').focus();}
break;}
case'text':{if($(this).find('input[type="text"]').val().trim()==''){requiredAttributeError=msg.please_enter+' '+attributeCaption;$(this).find('input[type="text"]').focus();}
break;}
case'textarea':{if($(this).find('textarea').val().trim()==''){requiredAttributeError=msg.please_enter+' '+attributeCaption;$(this).find('textarea').focus();}
break;}}}else{productMayBeAdded=true;}});}
if(requiredAttributeError!=''){alert(requiredAttributeError);return false;}
if(productMayBeAdded==undefined||(productMayBeAdded!=undefined&&productMayBeAdded)){let rex=/^(\d{1,})$/,err=false;if(!rex.test(frm.elements["oa_quantity"].value)){alert(msg.enter_numeric_product_quantity);frm.elements["oa_quantity"].focus();return false;}
let quantity=frm.elements["oa_quantity"].value*1;if($("meta[name='ddm-page']").attr('content')=='product'){if(productData.inventoryControl!='No'&&productData.allowOutOfInventoryOrder!='Yes'){if(((productData.inventoryControl=='Yes')||(productData.inventoryControl=='AttrRuleExc')||(productData.inventoryControl=='AttrRuleInc'&&inventoryHashFound))&&quantity>productData.stock){alert(msg.number_of_items_exceed_inventory.replace('%d',productData.stock));err=true;}}}else{if((maxAllowed!="-")&&(quantity>maxAllowed)){alert(msg.number_of_items_exceed_inventory.replace('%d',maxAllowed));err=true;}}
if(!err&&(quantity<minOrder)){alert(msg.number_of_items_exceeded_min);err=true;}
if(!err&&((maxOrder!="-")&&(quantity>maxOrder))){alert(msg.number_of_items_exceeded_max);err=true;}
if(err){frm.elements['oa_quantity'].focus();return false;}
return true;}
return false;};addToWishList=function(){let attributes=$('form[name="frmAddItem"] :input[name^="oa_attributes"]');$(attributes).each(function(){let hasVal=true,val=$(this).val();if($(this).is(':radio')&&!$(this).is(':checked')){hasVal=false;}
if(hasVal){input=$('<input>').attr({type:'hidden',name:$(this).attr('name'),value:val});$('#form-wishlist').append(input);}});};let productCanBeAddedToCart=function(productStock){$('#div-out-of-stock').hide();$('.view-product .product-add').show();if(productStock){if(parseInt($('.product-quantity').val())>productStock)
$('.product-quantity').val(productStock);$('.form-add-to-cart').attr('data-max-allowed',productStock);}
return true;};let productCannotBeAddedToCart=function(){$('#div-out-of-stock').show();$('.view-product .product-add').hide();return false;};let showProductStock=function(productStock){$('#product_stock').parent().show();$('#product_stock').parent().removeClass('d-none');$('#product_stock').html(productStock);};let hideProductStock=function(productStock){$('#product_stock').parent().hide();$('#product_stock').html(productStock);};let preSelectFirstAvailableVariant=function(productData){if(productData.inventoryHashes!=0){let variantCounter=0,allowOutOfStockOrder=productData.allowOutOfInventoryOrder=='Yes'?true:false,attrUsedInVariantsCount=0;$.each(productData.productAttributes,function(iAttr,attr){if(attr.track_inventory==1)attrUsedInVariantsCount++;});const parentEle=$('.product-attributes');$.each(productData.inventoryHashes,function(i,variantsData){let variant=variantsData.attributes_list.split('\n'),variantInvCtrlAttrRuleExcResult=false;if(productData.inventoryControl=='Yes'){variantsData.stock=parseInt(productData.stock);}
if(productData.inventoryControl=='AttrRuleExc'){if(parseInt(variantsData.stock)>0){if(parseInt(variantsData.stock)>=productData.minOrder)
variantInvCtrlAttrRuleExcResult=true;}else{variantInvCtrlAttrRuleExcResult=parseInt(variantsData.stock)>0;}
if(allowOutOfStockOrder)
variantInvCtrlAttrRuleExcResult=true;}
if(variant.length==attrUsedInVariantsCount&&variantCounter<1&&(productData.inventoryControl=='No'||(productData.inventoryControl=='Yes'&&(allowOutOfStockOrder?true:parseInt(productData.stock)>0))||variantInvCtrlAttrRuleExcResult)){variantCounter++;$.each(variant,function(iVar,dataVar){let attribute=dataVar.substr(0,dataVar.indexOf(':'));attribute=attribute.replace(/([\n\r\f\t ]+)/g,'-');let value=dataVar.substr(dataVar.indexOf(':')+1,dataVar.length+1).trim(),attributeEle=parentEle.find('.'+attribute);if(attributeEle.hasClass('product-attribute-select')){$.each(attributeEle.children(),function(iAttrEleSelect,vAttrEleSelect){if(urldecode($(vAttrEleSelect).val())==value){$(vAttrEleSelect).attr('selected','selected');if(productData.inventoryControl=='AttrRuleExc')
$('.form-add-to-cart').attr('data-max-allowed',variantsData.stock);}else{$(vAttrEleSelect).removeAttr('selected');}})}
if(attributeEle.hasClass('product-attribute-radio')){$.each(attributeEle,function(iAttrEleRadio,vAttrEleRadio){if(urldecode($(vAttrEleRadio).val())==value){$(vAttrEleRadio).attr('checked','checked');if(productData.inventoryControl=='AttrRuleExc')
$('.form-add-to-cart').attr('data-max-allowed',variantsData.stock);}else{$(vAttrEleRadio).removeAttr('checked');}})}});}});}};init();return{};}(jQuery));